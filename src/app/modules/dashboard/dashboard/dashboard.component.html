<app-layout>
    <div class="main-content">
        <app-navbar [pageTitle]="establishmentName"></app-navbar>

<!--        <app-navbar>-->
<!--            <ng-container *ngIf="currentEstablishment">-->
<!--                pageTitle="{{ establishmentName }}"-->
<!--                &lt;!&ndash; reste du contenu &ndash;&gt;-->
<!--            </ng-container>-->
<!--&lt;!&ndash;            pageTitle="{{ establishmentName }}"&ndash;&gt;-->
<!--        </app-navbar>-->
    </div>

    <div class="dashboard-content" *ngIf="currentEstablishment; else loading">
        <div class="main-section">
            <!-- Statistiques en haut -->
            <ng-container *ngIf="isAdmin; else adminStats">
                <app-statistics-cards
                        [currentUsersCount]="userMetrics?.currentUsers || 0"
                        [adminsCount]="userMetrics?.adminsCount || 0"
                        [classesCount]="userMetrics?.maxUsers || 0"
                        [globalPresencePercentage]="dailyStats?.presenceRate || 0"
                        [isSuperAdmin]="false">
                </app-statistics-cards>
            </ng-container>

            <ng-template #adminStats>
                <app-statistics-cards
                        [isSuperAdmin]="true"
                        [globalStats]="globalStats">
                </app-statistics-cards>
            </ng-template>

            <!-- Graphique de performance (caché pour SuperAdmin) -->
            <app-school-performance-chart
                    *ngIf="!isAdmin"
                    [yearlyPresenceStats]="yearlyStats"
                    [currentYear]="currentYear"
                    [previousYear]="previousYear">
            </app-school-performance-chart>

            <div class="two-columns">
                <!-- Calendrier (visible pour tous) -->
                <div class="column">
                    <app-organization-calendar></app-organization-calendar>
                </div>

                <!-- Graphique de présence (caché pour SuperAdmin) -->
                <div class="column" *ngIf="!isAdmin">
                    <app-organization-presence-chart
                            [establishmentId]="establishmentId">
                    </app-organization-presence-chart>
                </div>
            </div>

            <!-- Activités récentes (adapté pour les deux rôles) -->
            <app-recent-administration-activity
                    [establishmentId]="establishmentId"
                    [isSuperAdmin]="isAdmin">
            </app-recent-administration-activity>
        </div>

        <div class="side-section">
            <!-- Top ranking (adapté pour les deux rôles) -->
            <app-recent-students
                    [establishmentId]="establishmentId"
                    [isSuperAdmin]="isAdmin">
            </app-recent-students>

            <!-- Messages (caché pour SuperAdmin) -->
            <app-dashboard-messages
                    *ngIf="!isAdmin"
                    [establishmentId]="establishmentId">
            </app-dashboard-messages>

            <!-- Services (remplacé par top établissements capacité max pour SuperAdmin) -->
<!--            <ng-container *ngIf="isAdmin && topByTotalUsers.length > 0">-->
<!--                <app-recent-students-->
<!--                        [title]="'Top 10 Establishments (Max Capacity)'"-->
<!--                        [users]="topByTotalUsers"-->
<!--                        [isEstablishment]="true">-->
<!--                </app-recent-students>-->
<!--            </ng-container>-->
        </div>
    </div>

    <ng-template #loading>
        <div class="loading-container">
            <p>Chargement des données en cours...</p>
            <!-- Vous pouvez aussi ajouter un spinner ici -->
        </div>
    </ng-template>
</app-layout>





<!--<app-layout>-->
<!--    <div class="main-content">-->
<!--        <app-navbar>-->
<!--            pageTitle="{{ establishmentName }}"-->
<!--        </app-navbar>-->
<!--    </div>-->

<!--    <div class="dashboard-content">-->
<!--        <div class="main-section">-->
<!--            &lt;!&ndash; Statistiques en haut &ndash;&gt;-->
<!--            <app-statistics-cards-->
<!--                    [currentUsersCount]="userMetrics?.currentUsers || 0"-->
<!--                    [adminsCount]="userMetrics?.adminsCount || 0"-->
<!--                    [classesCount]="userMetrics?.adminsCount || 0"-->
<!--                    [globalPresencePercentage]="dailyStats?.presenceRate || 0">-->
<!--            </app-statistics-cards>-->

<!--            &lt;!&ndash; Graphique de performance &ndash;&gt;-->
<!--            <app-school-performance-chart-->
<!--                    [yearlyPresenceStats]="yearlyStats"-->
<!--                    [currentYear]="currentYear"-->
<!--                    [previousYear]="previousYear">-->
<!--            </app-school-performance-chart>-->

<!--            <div class="two-columns">-->
<!--                &lt;!&ndash; Calendrier &ndash;&gt;-->
<!--                <div class="column">-->
<!--                    <app-organization-calendar></app-organization-calendar>-->
<!--                </div>-->

<!--                &lt;!&ndash; Graphique de présence &ndash;&gt;-->
<!--                <div class="column">-->
<!--                    <app-organization-presence-chart-->
<!--                            [establishmentId]="currentEstablishmentId">-->
<!--                    </app-organization-presence-chart>-->
<!--&lt;!&ndash;                    <app-organization-presence-chart></app-organization-presence-chart>&ndash;&gt;-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Activités récentes &ndash;&gt;-->
<!--            <app-recent-administration-activity-->
<!--                    [establishmentId]="currentEstablishmentId">-->
<!--            </app-recent-administration-activity>-->
<!--        </div>-->

<!--        <div class="side-section">-->
<!--            &lt;!&ndash; Top ranking users &ndash;&gt;-->
<!--            <app-recent-students [establishmentId]="currentEstablishmentId"></app-recent-students>-->

<!--            &lt;!&ndash; lastest infos &ndash;&gt;-->
<!--            <app-dashboard-messages [establishmentId]="currentEstablishmentId"></app-dashboard-messages>-->

<!--            &lt;!&ndash; Services &ndash;&gt;-->
<!--&lt;!&ndash;            <app-dashboard-services></app-dashboard-services>&ndash;&gt;-->
<!--        </div>-->
<!--    </div>-->
<!--</app-layout>-->


<!--<app-layout>-->
<!--    <div class="main-content">-->
<!--        <app-navbar>-->
<!--            pageTitle="{{ establishmentName }}"-->
<!--        </app-navbar>-->
<!--    </div>-->

<!--    <div class="dashboard-content">-->
<!--        <div class="main-section">-->
<!--            &lt;!&ndash; Statistiques en haut &ndash;&gt;-->
<!--            <app-statistics-cards-->
<!--                    *ngIf="isAdmin; else publicStats"-->
<!--                    [currentUsersCount]="userMetrics?.currentUsers || 0"-->
<!--                    [adminsCount]="userMetrics?.adminsCount || 0"-->
<!--                    [classesCount]="userMetrics?.adminsCount || 0"-->
<!--                    [globalPresencePercentage]="dailyStats?.presenceRate || 0">-->
<!--            </app-statistics-cards>-->

<!--            <ng-template #publicStats>-->
<!--                <app-statistics-cards-->
<!--                        [currentUsersCount]="globalStats?.totalUsers || 0"-->
<!--                        [adminsCount]="globalStats?.maxCapacity || 0"-->
<!--                        [classesCount]="globalStats?.totalEstablishments || 0"-->
<!--                        [globalPresencePercentage]="0">-->
<!--                </app-statistics-cards>-->
<!--            </ng-template>-->

<!--            &lt;!&ndash; Graphique de performance (caché pour les non-admins) &ndash;&gt;-->
<!--            <app-school-performance-chart-->
<!--                    *ngIf="isAdmin"-->
<!--                    [yearlyPresenceStats]="yearlyStats"-->
<!--                    [currentYear]="currentYear"-->
<!--                    [previousYear]="previousYear">-->
<!--            </app-school-performance-chart>-->

<!--            <div class="two-columns">-->
<!--                &lt;!&ndash; Calendrier &ndash;&gt;-->
<!--                <div class="column">-->
<!--                    <app-organization-calendar></app-organization-calendar>-->
<!--                </div>-->

<!--                &lt;!&ndash; Graphique de présence (caché pour les non-admins) &ndash;&gt;-->
<!--                <div class="column" *ngIf="isAdmin">-->
<!--                    <app-organization-presence-chart-->
<!--                            [establishmentId]="currentEstablishmentId">-->
<!--                    </app-organization-presence-chart>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Activités récentes (caché pour les non-admins) &ndash;&gt;-->
<!--            <app-recent-administration-activity-->
<!--                    *ngIf="isAdmin"-->
<!--                    [establishmentId]="currentEstablishmentId">-->
<!--            </app-recent-administration-activity>-->
<!--        </div>-->

<!--        <div class="side-section">-->
<!--            &lt;!&ndash; Top ranking users (remplacé par top établissements pour les non-admins) &ndash;&gt;-->
<!--            <ng-container *ngIf="isAdmin; else publicTopUsers">-->
<!--                <app-recent-students [establishmentId]="currentEstablishmentId"></app-recent-students>-->
<!--            </ng-container>-->

<!--            <ng-template #publicTopUsers>-->
<!--                <app-recent-students-->
<!--                        *ngIf="topByExistingUsers.length > 0"-->
<!--                        [title]="'Top 10 établissements (utilisateurs actifs)'"-->
<!--                        [users]="topByExistingUsers">-->
<!--                </app-recent-students>-->
<!--            </ng-template>-->

<!--            &lt;!&ndash; lastest infos (caché pour les non-admins) &ndash;&gt;-->
<!--            <app-dashboard-messages-->
<!--                    *ngIf="isAdmin"-->
<!--                    [establishmentId]="currentEstablishmentId">-->
<!--            </app-dashboard-messages>-->

<!--            &lt;!&ndash; Services (remplacé par top établissements capacité max pour les non-admins) &ndash;&gt;-->
<!--            <ng-container *ngIf="!isAdmin && topByTotalUsers.length > 0">-->
<!--                <app-recent-students-->
<!--                        [title]="'Top 10 établissements (capacité max)'"-->
<!--                        [users]="topByTotalUsers">-->
<!--                </app-recent-students>-->
<!--            </ng-container>-->
<!--        </div>-->
<!--    </div>-->
<!--</app-layout>-->