<app-layout>
    <div class="main-content">
        <app-navbar [pageTitle]="establishmentName"></app-navbar>
    </div>

    <div class="dashboard-content" *ngIf="currentEstablishment && !isLoading">
        <div class="main-section">
            <!-- Statistiques en haut -->
                <app-statistics-cards
                        [currentUsersCount]="userMetrics?.currentUsers || 0"
                        [adminsCount]="userMetrics?.adminsCount || 0"
                        [classesCount]="userMetrics?.maxUsers || 0"
                        [globalPresencePercentage]="dailyStats?.presenceRate || 0"
                        [isSuperAdmin]="false">
                </app-statistics-cards>

<!--            <ng-template #adminStats>-->
<!--                <app-statistics-cards-->
<!--                        [isSuperAdmin]="true"-->
<!--                        [globalStats]="globalStats">-->
<!--                </app-statistics-cards>-->
<!--            </ng-template>-->

            <!-- Graphique de performance (caché pour SuperAdmin) -->
            <app-school-performance-chart
                    [yearlyPresenceStats]="yearlyStats"
                    [currentYear]="currentYear"
                    [previousYear]="previousYear">
            </app-school-performance-chart>

            <div class="two-columns">
                <!-- Calendrier (visible pour tous) -->
                <div class="column">
                    <app-organization-calendar></app-organization-calendar>
                </div>

                <!-- Graphique de présence (caché pour SuperAdmin) -->
                <div class="column">
                    <app-organization-presence-chart
                            [establishmentId]="establishmentId">
                    </app-organization-presence-chart>
                </div>
            </div>

            <!-- Activités récentes (adapté pour les deux rôles) -->
            <app-recent-administration-activity
                    [establishmentId]="establishmentId"
                    [isSuperAdmin]="false">
            </app-recent-administration-activity>
        </div>

        <div class="side-section">
            <!-- Top ranking (adapté pour les deux rôles) -->
            <app-recent-students
                    [establishmentId]="establishmentId"
                    [isSuperAdmin]="false">
            </app-recent-students>

            <!-- Messages (caché pour SuperAdmin) -->
            <app-dashboard-messages
                    [establishmentId]="establishmentId">
            </app-dashboard-messages>

            <!-- Services (remplacé par top établissements capacité max pour SuperAdmin) -->
<!--            <ng-container *ngIf="isAdmin && topByTotalUsers.length > 0">-->
<!--                <app-recent-students-->
<!--                        [title]="'Top 10 Establishments (Max Capacity)'"-->
<!--                        [users]="topByTotalUsers"-->
<!--                        [isEstablishment]="true">-->
<!--                </app-recent-students>-->
<!--            </ng-container>-->
        </div>
    </div>

    <div class="loading-container" *ngIf="isLoading">
        <p>Chargement des données en cours...</p>
        <!-- Vous pouvez aussi ajouter un spinner ici -->
    </div>

    <div class="no-establishment-warning" *ngIf="!isLoading && !currentEstablishment">
        <div class="warning-content">
            <i class="warning-icon">⚠️</i>
            <h3>Établissement non trouvé</h3>
            <p>Nous n'avons pas réussi identifier votre établissement. Certaines fonctionnalités seront limitées.</p>
            <p>Veuillez contacter l'administration si cela persiste.</p>
            <!-- On pourrait ajouter un bouton pour réessayer -->
            <button class="retry-button" (click)="retryLoading()">
                Réessayer
            </button>
        </div>
    </div>

<!--    <ng-template *ngIf="!currentEstablishment; else loading">-->
<!--        <div class="no-establishment-warning" *ngIf="!currentEstablishment; else loading">-->
<!--            <div class="warning-content">-->
<!--                <i class="warning-icon">⚠️</i>-->
<!--                <h3>Établissement non trouvé</h3>-->
<!--                <p>Nous n'avons pas réussi identifier votre établissement. Certaines fonctionnalités seront limitées.</p>-->
<!--                <p>Veuillez contacter l'administration si cela persiste.</p>-->
<!--                &lt;!&ndash; On pourrait ajouter un bouton pour réessayer &ndash;&gt;-->
<!--                <button class="retry-button" (click)="retryLoading()">-->
<!--                    Réessayer-->
<!--                </button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </ng-template>-->

<!--    <ng-template #loading>-->
<!--        <div class="loading-container" *ngIf="isLoading">-->
<!--            <p>Chargement des données en cours...</p>-->
<!--            &lt;!&ndash; Vous pouvez aussi ajouter un spinner ici &ndash;&gt;-->
<!--        </div>-->
<!--    </ng-template>-->
</app-layout>