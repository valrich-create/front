<app-layout>
    <app-navbar [pageTitle]="isEditMode ? 'Edit Class/Service' : 'New Class/Service'"></app-navbar>

    <div class="content-container">
        <div class="event-form-container">
            <div class="form-card">
                <div class="card-header">
                    <h2>{{ isEditMode ? 'Edit Class/Service' : 'Create New Class/Service' }}</h2>
                </div>

                <div class="card-content">
                    <form [formGroup]="classServiceForm" (ngSubmit)="onSubmit()">
                        <!-- Name -->
                        <div class="form-group">
                            <label for="nom">Name <span class="required">*</span></label>
                            <input
                                    type="text"
                                    id="nom"
                                    formControlName="nom"
                                    placeholder="Enter class/service name"
                                    class="form-control"
                                    [ngClass]="{'invalid-input': isFieldInvalid('nom')}"
                            >
                            <div class="error-message" *ngIf="isFieldInvalid('nom')">
                                Name is required
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea
                                    id="description"
                                    formControlName="description"
                                    placeholder="Enter description (optional)"
                                    class="form-control"
                                    rows="3"
                            ></textarea>
                        </div>

                        <!-- Department Selection -->
                        <div class="form-group">
                            <label for="departmentId">Département</label>
                            <select
                                    id="departmentId"
                                    formControlName="departmentId"
                                    class="form-control"
                                    [disabled]="isLoadingDepartments"
                            >
                                <option value="">-- Sélectionner un département --</option>
                                <option *ngFor="let department of departments" [value]="department.id">
                                    {{ department.title }}
                                </option>
                            </select>
                            <small class="form-text" *ngIf="classServiceForm.get('departmentId')?.disabled">
                                Choisir soit Département, soit Sous-département, soit Niveau 3
                            </small>
                        </div>

                        <!-- Sub-Department Selection -->
                        <div class="form-group">
                            <label for="subDepartmentId">Sous-département</label>
                            <select
                                    id="subDepartmentId"
                                    formControlName="subDepartmentId"
                                    class="form-control"
                                    [disabled]="isLoadingSubDepartments"
                            >
                                <option value="">-- Sélectionner un sous-département --</option>
                                <option *ngFor="let subDepartment of subDepartments" [value]="subDepartment.id">
                                    {{ subDepartment.title }}
                                </option>
                            </select>
                            <small class="form-text" *ngIf="classServiceForm.get('subDepartmentId')?.disabled">
                                Choisir soit Département, soit Sous-département, soit Niveau 3
                            </small>
                        </div>

                        <!-- Third Level Department Selection -->
                        <div class="form-group">
                            <label for="thirdLevelDepartmentId">Département Niveau 3</label>
                            <select
                                    id="thirdLevelDepartmentId"
                                    formControlName="thirdLevelDepartmentId"
                                    class="form-control"
                                    [disabled]="isLoadingThirdLevelDepartments"
                            >
                                <option value="">-- Sélectionner un département niveau 3 --</option>
                                <option *ngFor="let thirdLevelDept of thirdLevelDepartments" [value]="thirdLevelDept.id">
                                    {{ thirdLevelDept.title }}
                                </option>
                            </select>
                            <small class="form-text" *ngIf="classServiceForm.get('thirdLevelDepartmentId')?.disabled">
                                Choisir soit Département, soit Sous-département, soit Niveau 3
                            </small>
                        </div>

                        <!-- Hidden establishment ID -->
                        <input type="hidden" formControlName="establishmentId">

                        <div class="form-actions">
                            <button type="button" class="btn-cancel" (click)="onCancel()">Cancel</button>
                            <button type="submit" class="btn-submit" [disabled]="classServiceForm.invalid">
                                {{ isEditMode ? 'Update' : 'Create' }}
                            </button>
                        </div>

                        <!-- Information notes -->
                        <div class="form-notes">
                            <p><strong>Après avoir créé cette classe ou ce service, n'oubliez pas de :</strong></p>
                            <ul>
                                <li>Configurer les plannings de présence</li>
                                <li>Assigner des utilisateurs</li>
                                <li>Configurer la zone de présence</li>
                            </ul>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</app-layout>