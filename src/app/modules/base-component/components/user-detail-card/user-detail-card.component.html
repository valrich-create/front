<app-layout>
    <div class="admin-detail-container">
        <app-navbar [pageTitle]="pageTitle"></app-navbar>

        <div class="admin-header">
            <div class="header-actions">
                <div class="search-container"></div>
            </div>
        </div>

        <div class="profile-card" *ngIf="user">
            <!-- Banner -->
            <div class="profile-banner">
                <div class="banner-decorations">
                    <div class="decoration circle-1"></div>
                    <div class="decoration circle-2"></div>
                </div>
            </div>

            <!-- Profile picture container -->
            <div class="profile-picture-container">
                <div class="profile-picture">
                    <ng-container *ngIf="hasProfileImage(); else initialsBlock">
                        <img [src]="user.profileImageUrl" alt="Profile Image" />
                    </ng-container>
                    <ng-template #initialsBlock>
                        {{ getInitials() }}
                    </ng-template>
                </div>
            </div>

            <!-- Main Profile Info -->
            <div class="profile-info">
                <div class="profile-main-info">
                    <h2 class="profile-name">{{ user.firstName || 'N/A' }} {{ user.lastName || 'N/A' }}</h2>
                    <p class="profile-role">{{ user.role || 'N/A' }}</p>
                </div>

                <!-- Sections Grid -->
                <div class="profile-sections-grid">
                    <!-- Contact Information -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="bi bi-person-lines-fill"></i>
                            Informations de contact
                        </h3>
                        <ul class="info-list">
                            <li class="info-item">
                                <span class="info-label">Email</span>
                                <span class="info-value" [class.na-value]="!user.email">
                                    {{ user.email || 'N/A' }}
                                </span>
                            </li>
                            <li class="info-item">
                                <span class="info-label">Téléphone</span>
                                <span class="info-value" [class.na-value]="!user.phoneNumber">
                                    {{ user.phoneNumber || 'N/A' }}
                                </span>
                            </li>
                        </ul>
                    </div>

                    <!-- Personal Information -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="bi bi-calendar-event"></i>
                            Informations personnelles
                        </h3>
                        <ul class="info-list">
                            <li class="info-item">
                                <span class="info-label">Date de naissance</span>
                                <span class="info-value" [class.na-value]="!user.dateOfBirth">
                                    {{ user.dateOfBirth ? (user.dateOfBirth | date) : 'N/A' }}
                                </span>
                            </li>
                            <li class="info-item">
                                <span class="info-label">Lieu de naissance</span>
                                <span class="info-value" [class.na-value]="!user.placeOfBirth">
                                    {{ user.placeOfBirth || 'N/A' }}
                                </span>
                            </li>
                        </ul>
                    </div>

                    <!-- System Information -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="bi bi-gear-fill"></i>
                            Informations système
                        </h3>
                        <ul class="info-list">
                            <li class="info-item">
                                <span class="info-label">Créé le</span>
                                <span class="info-value" [class.na-value]="!user.createdAt">
                                    {{ user.createdAt ? (user.createdAt | date:'medium') : 'N/A' }}
                                </span>
                            </li>
                            <li class="info-item">
                                <span class="info-label">Mis à jour le</span>
                                <span class="info-value" [class.na-value]="!user.updatedAt">
                                    {{ user.updatedAt ? (user.updatedAt | date:'medium') : 'N/A' }}
                                </span>
                            </li>
                        </ul>
                    </div>

                    <!-- Assignments -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="bi bi-building"></i>
                            Assignations
                        </h3>
                        <ul class="info-list">
                            <li class="info-item">
                                <span class="info-label">Établissement</span>
                                <span class="info-value" [class.na-value]="!user.establishmentName">
                                    {{ user.establishmentName || 'N/A' }}
                                </span>
                            </li>
                            <li class="info-item">
                                <span class="info-label">Classe / Service</span>
                                <span class="info-value" [class.na-value]="!user.classeServiceNom">
                                    {{ user.classeServiceNom || 'N/A' }}
                                </span>
                            </li>
                            <li class="info-item">
                                <span class="info-label">Manager</span>
                                <span class="info-value" [class.na-value]="!user.classeManagerNom">
                                    {{ user.classeManagerNom || 'N/A' }}
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="profile-actions-buttons">
                    <button class="action-button edit-button" (click)="onEdit(user)">
                        <i class="fas fa-pen-to-square"></i> Modifier
                    </button>

                    <button class="action-button delete-button" (click)="onDelete(user)">
                        <i class="fas fa-trash"></i> Supprimer
                    </button>

                    <button *ngIf="onAssignToClass"
                            class="action-button assign-button"
                            (click)="onAssignToClass(user)">
                        <i [class]="getAssignButtonIcon()"></i>
                        {{ getAssignButtonLabel() }}
                    </button>

                    <button class="action-button reset-password-button" (click)="openPasswordResetModal()">
                        <i class="fas fa-key"></i> Réinitialiser le mot de passe
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de réinitialisation du mot de passe -->
        <div class="password-reset-modal-overlay" *ngIf="showPasswordResetModal" (click)="closePasswordResetModal()">
            <div class="password-reset-modal" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <h3>Réinitialiser le mot de passe</h3>
                    <button class="close-button" (click)="closePasswordResetModal()" type="button">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <label for="newPassword">Nouveau mot de passe</label>
                        <div class="password-input-container">
                            <input
                                    [type]="showPassword ? 'text' : 'password'"
                                    id="newPassword"
                                    class="form-input"
                                    [(ngModel)]="newPassword"
                                    (input)="onPasswordInput()"
                                    placeholder="Saisir le nouveau mot de passe"
                                    [disabled]="isSubmitting"
                            />
                            <button
                                    type="button"
                                    class="password-toggle"
                                    (click)="togglePasswordVisibility()"
                                    [disabled]="isSubmitting"
                            >
                                <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                            </button>
                        </div>

                        <div class="password-requirements">
                            <small>Le mot de passe doit contenir :</small>
                            <ul>
                                <li>Au moins 8 caractères</li>
                                <li>Au moins une majuscule</li>
                                <li>Au moins un chiffre</li>
                                <li>Au moins un caractère spécial</li>
                            </ul>
                        </div>

                        <div class="error-message" *ngIf="passwordError">
                            <i class="fas fa-exclamation-triangle"></i>
                            {{ passwordError }}
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button
                            type="button"
                            class="btn btn-cancel"
                            (click)="closePasswordResetModal()"
                            [disabled]="isSubmitting"
                    >
                        Annuler
                    </button>
                    <button
                            type="button"
                            class="btn btn-confirm"
                            (click)="confirmPasswordReset()"
                            [disabled]="isSubmitting || !newPassword || !!passwordError"
                    >
                        <span *ngIf="isSubmitting">
                            <i class="fas fa-spinner fa-spin"></i> En cours...
                        </span>
                        <span *ngIf="!isSubmitting">Confirmer</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</app-layout>