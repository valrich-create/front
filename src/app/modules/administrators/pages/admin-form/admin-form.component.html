<app-layout>
    <div class="admin-form-container">
        <app-navbar [pageTitle]="isEditMode ? 'Edit Admin' : 'New Admin'"></app-navbar>

        <div class="form-wrapper">
            <form [formGroup]="adminForm" (ngSubmit)="onSubmit()" class="modern-form">

                <!-- Personal Details Section -->
                <div class="form-card">
                    <div class="card-header">
                        <h2>Personal Details</h2>
                        <div class="header-line"></div>
                    </div>
                    <div class="card-content">

                        <div class="input-grid">
                            <div class="input-group">
                                <label for="firstName" class="modern-label">
                                    First Name <span class="required-star">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input
                                            type="text"
                                            id="firstName"
                                            formControlName="firstName"
                                            placeholder="Enter first name"
                                            class="modern-input"
                                            [class.error]="adminForm.get('firstName')?.invalid && adminForm.get('firstName')?.touched"
                                    >
                                    <div class="input-border"></div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('firstName')?.invalid && adminForm.get('firstName')?.touched">
                                    <span class="error-icon">!</span>
                                    First name is required
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="lastName" class="modern-label">
                                    Last Name <span class="required-star">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input
                                            type="text"
                                            id="lastName"
                                            formControlName="lastName"
                                            placeholder="Enter last name"
                                            class="modern-input"
                                            [class.error]="adminForm.get('lastName')?.invalid && adminForm.get('lastName')?.touched"
                                    >
                                    <div class="input-border"></div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('lastName')?.invalid && adminForm.get('lastName')?.touched">
                                    <span class="error-icon">!</span>
                                    Last name is required
                                </div>
                            </div>
                        </div>

                        <div class="input-grid">
                            <div class="input-group">
                                <label for="email" class="modern-label">
                                    Email Address <span class="required-star">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input
                                            type="email"
                                            id="email"
                                            formControlName="email"
                                            placeholder="Enter email address"
                                            class="modern-input"
                                            [class.error]="adminForm.get('email')?.invalid && adminForm.get('email')?.touched"
                                    >
                                    <div class="input-border"></div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('email')?.invalid && adminForm.get('email')?.touched">
                                    <span class="error-icon">!</span>
                                    Valid email is required
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="phoneNumber" class="modern-label">
                                    Phone Number <span class="required-star">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input
                                            type="tel"
                                            id="phoneNumber"
                                            formControlName="phoneNumber"
                                            placeholder="+237 6 99 99 99 99"
                                            class="modern-input"
                                            [class.error]="adminForm.get('phoneNumber')?.invalid && adminForm.get('phoneNumber')?.touched"
                                    >
                                    <div class="input-border"></div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('phoneNumber')?.invalid && adminForm.get('phoneNumber')?.touched">
                                    <span class="error-icon">!</span>
                                    Phone number is required
                                </div>
                            </div>
                        </div>

                        <div class="input-grid">
                            <div class="input-group">
                                <label for="dateOfBirth" class="modern-label">Date of Birth</label>
                                <div class="input-wrapper">
                                    <input
                                            type="date"
                                            id="dateOfBirth"
                                            formControlName="dateOfBirth"
                                            [max]="maxBirthDate | date:'yyyy-MM-dd'"
                                            class="modern-input"
                                            [class.error]="adminForm.get('dateOfBirth')?.invalid && adminForm.get('dateOfBirth')?.touched"
                                    >
                                    <div class="input-border"></div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('dateOfBirth')?.errors?.['futureDate']">
                                    <span class="error-icon">!</span>
                                    Birth date cannot be in the future
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="placeOfBirth" class="modern-label">Place of Birth</label>
                                <div class="input-wrapper">
                                    <input
                                            type="text"
                                            id="placeOfBirth"
                                            formControlName="placeOfBirth"
                                            placeholder="City, Country"
                                            class="modern-input"
                                    >
                                    <div class="input-border"></div>
                                </div>
                            </div>
                        </div>

                        <div class="input-grid">
                            <div class="input-group full-width">
                                <label for="organization" class="modern-label">
                                    Organization <span class="required-star">*</span>
                                </label>
                                <div class="select-wrapper">
                                    <select
                                            id="organization"
                                            formControlName="establishmentId"
                                            class="modern-select"
                                            [class.error]="adminForm.get('establishmentId')?.invalid && adminForm.get('establishmentId')?.touched"
                                    >
                                        <option value="" disabled selected>Select organization</option>
                                        <option *ngFor="let org of organizations" [value]="org.id">{{ org.nom }}</option>
                                    </select>
                                    <div class="select-arrow">
                                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                                            <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('establishmentId')?.invalid && adminForm.get('establishmentId')?.touched">
                                    <span class="error-icon">!</span>
                                    Organization is required
                                </div>
                            </div>
                        </div>

                        <div class="input-grid">
                            <div class="input-group">
                                <label for="role" class="modern-label">
                                    Role <span class="required-star">*</span>
                                </label>
                                <div class="select-wrapper">
                                    <select
                                            id="role"
                                            formControlName="role"
                                            class="modern-select"
                                            [class.error]="adminForm.get('role')?.invalid && adminForm.get('role')?.touched"
                                    >
                                        <option value="" disabled selected>Select role</option>
                                        <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
                                    </select>
                                    <div class="select-arrow">
                                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                                            <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('role')?.invalid && adminForm.get('role')?.touched">
                                    <span class="error-icon">!</span>
                                    Role is required
                                </div>
                            </div>
                        </div>

                        <!-- Permissions Section -->
                        <div class="permissions-section">
                            <h3 class="section-title">
                                <span class="title-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                        <path d="M12 15L17 10H7L12 15Z" fill="currentColor"/>
                                    </svg>
                                </span>
                                Permissions
                            </h3>
                            <div class="permissions-grid" formArrayName="permissions" *ngIf="permissionsFormArray.length === authorizations.length">
                                <div class="permission-item" *ngFor="let permission of authorizations; let i = index">
                                    <label class="checkbox-container">
                                        <input
                                                type="checkbox"
                                                [id]="'permission-' + i"
                                                [formControlName]="i"
                                                [formControl]="permissionsFormArray.at(i)"
                                                class="hidden-checkbox"
                                        >
                                        <span class="custom-checkbox">
                                            <svg class="check-icon" width="12" height="10" viewBox="0 0 12 10" fill="none">
                                                <path d="M10 2L4.5 8L2 5.27273" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </span>
                                        <span class="permission-label">{{ permission }}</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Profile Photo Section -->
                <div class="form-card">
                    <div class="card-header">
                        <h2>Profile Photo</h2>
                        <div class="header-line"></div>
                    </div>
                    <div class="card-content">

                        <div class="photo-upload-area">
                            <div class="photo-section">
                                <div class="photo-preview-container"
                                     (dragover)="onDragOver($event)"
                                     (dragleave)="onDragLeave($event)"
                                     (drop)="onDrop($event)">

                                    <div class="photo-preview" [class.has-photo]="photoPreview">
                                        <div *ngIf="!photoPreview" class="photo-placeholder">
                                            <div class="upload-icon">
                                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                                                    <path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" stroke="currentColor" stroke-width="1.5"/>
                                                    <path d="M20.59 22C20.59 18.13 16.74 15 12 15C7.26 15 3.41 18.13 3.41 22" stroke="currentColor" stroke-width="1.5"/>
                                                </svg>
                                            </div>
                                            <h4>Upload Photo</h4>
                                            <p>Drop your image here</p>
                                        </div>

                                        <img *ngIf="photoPreview" [src]="photoPreview" alt="Profile preview" />

                                        <div class="photo-overlay" *ngIf="photoPreview">
                                            <button type="button" class="remove-photo-btn" (click)="removePhoto()">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    <input
                                            type="file"
                                            id="profilePhoto"
                                            accept="image/*"
                                            (change)="onFileSelected($event)"
                                            style="display: none;"
                                    >

                                </div>

                                <div class="photo-actions">
                                    <label for="profilePhoto" class="upload-btn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <path d="M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15" stroke="currentColor" stroke-width="2"/>
                                            <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M12 3V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        {{ photoPreview ? 'Change Photo' : 'Choose Photo' }}
                                    </label>
                                </div>
                            </div>

                            <div class="photo-info">
                                <div class="info-item">
                                    <h4>Photo Guidelines</h4>
                                    <ul>
                                        <li>• JPG, PNG or GIF format</li>
                                        <li>• Maximum file size: 5MB</li>
                                        <li>• Square images work best</li>
                                        <li>• Minimum 200x200 pixels</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Password Section -->
                <div *ngIf="!isEditMode || (isEditMode && adminForm.get('password')?.value)" class="form-card">
                    <div class="card-header">
                        <h2>Account Credentials</h2>
                        <div class="header-line"></div>
                    </div>
                    <div class="card-content">

                        <div *ngIf="isEditMode" class="info-banner">
                            <div class="banner-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <p>Leave password fields blank to keep current password</p>
                        </div>

                        <div class="input-grid">
                            <div class="input-group">
                                <label for="password" class="modern-label">
                                    Password {{ isEditMode ? '' : '*' }}
                                </label>
                                <div class="input-wrapper password-wrapper">
                                    <input
                                            [type]="showPassword ? 'text' : 'password'"
                                            id="password"
                                            formControlName="password"
                                            placeholder="Enter password"
                                            class="modern-input password-input"
                                            [class.error]="adminForm.get('password')?.invalid && adminForm.get('password')?.touched"
                                    >
                                    <button
                                            type="button"
                                            class="password-toggle"
                                            (click)="togglePasswordVisibility()"
                                    >
                                        <svg *ngIf="!showPassword" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2"/>
                                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        <svg *ngIf="showPassword" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C5 20 1 12 1 12A18.45 18.45 0 0 1 5.06 5.06L17.94 17.94Z" stroke="currentColor" stroke-width="2"/>
                                            <path d="M1 1L23 23" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                    </button>
                                    <div class="input-border"></div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.get('password')?.invalid && adminForm.get('password')?.touched">
                                    <span class="error-icon">!</span>
                                    Password must be at least 8 characters
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="confirmPassword" class="modern-label">
                                    Confirm Password {{ isEditMode ? '' : '*' }}
                                </label>
                                <div class="input-wrapper password-wrapper">
                                    <input
                                            [type]="showConfirmPassword ? 'text' : 'password'"
                                            id="confirmPassword"
                                            formControlName="confirmPassword"
                                            placeholder="Confirm password"
                                            class="modern-input password-input"
                                            [class.error]="(adminForm.get('confirmPassword')?.invalid || adminForm.hasError('mismatch')) && adminForm.get('confirmPassword')?.touched"
                                    >
                                    <button
                                            type="button"
                                            class="password-toggle"
                                            (click)="toggleConfirmPasswordVisibility()"
                                    >
                                        <svg *ngIf="!showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2"/>
                                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        <svg *ngIf="showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C5 20 1 12 1 12A18.45 18.45 0 0 1 5.06 5.06L17.94 17.94Z" stroke="currentColor" stroke-width="2"/>
                                            <path d="M1 1L23 23" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                    </button>
                                    <div class="input-border"></div>
                                </div>
                                <div class="error-message"
                                     *ngIf="adminForm.hasError('mismatch') && adminForm.get('confirmPassword')?.touched">
                                    <span class="error-icon">!</span>
                                    Passwords do not match
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" (click)="cancel()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary" [disabled]="adminForm.invalid">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        {{ isEditMode ? 'Update' : 'Create' }}
                    </button>
                </div>

            </form>
        </div>
    </div>
</app-layout>