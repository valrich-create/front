<app-layout>
    <div class="organizations-container">

        <app-navbar
                pageTitle="Organizations">
        </app-navbar>

        <div class="filter-container">

            <app-search-bar
                    newButtonText="New Establishment"
                    newItemRoute="/organizations/new"
                    [currentSort]="currentSort"
                    (sortChange)="onSortChange($event)"
                    (searchChange)="onSearchChange($event)">
            </app-search-bar>
            <app-filter-tabs
                    [tabs]="timePeriods"
                    [activeTab]="selectedTimePeriod"
                    (tabChange)="handleTimePeriodChange($event)">
            </app-filter-tabs>
        </div>

        <div class="organizations-list">
            <app-organization-card
                    *ngFor="let org of organizations"
                    [establishment]="org"
                    [timePeriod]="selectedTimePeriod"
                    (click)="navigateToDetail(org.id)"
                    (viewDetails)="onViewDetails($event)"
                    (editEstablishment)="onEditEstablishment($event)"
                    (deleteEstablishment)="onDeleteEstablishment($event)">
            </app-organization-card>
        </div>

        <div class="pagination">
            <button
                    class="pagination-button prev"
                    [disabled]="currentPage === 1"
                    (click)="goToPage(currentPage - 1)">
                <span class="material-icons">chevron_left</span>
            </button>

            <div class="page-numbers">
                <button
                        *ngFor="let page of getPageNumbers()"
                        class="page-number"
                        [class.active]="page === currentPage"
                        (click)="goToPage(page)">
                    {{ page }}
                </button>
            </div>

            <button
                    class="pagination-button next"
                    [disabled]="currentPage === totalPages"
                    (click)="goToPage(currentPage + 1)">
                <span class="material-icons">chevron_right</span>
            </button>
        </div>

        <div class="pagination-info">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentPage * itemsPerPage, totalItems) }} from {{ totalItems }} data
        </div>
    </div>

    <!-- Modal de détails -->
    <div class="modal-overlay" *ngIf="showDetailsModal" (click)="closeDetailsModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Détails {{ establishmentName }}</h2>
                <button class="close-button" (click)="closeDetailsModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body" *ngIf="selectedEstablishment">
                <div class="detail-row">
                    <label>Nom :</label>
                    <span>{{ selectedEstablishment.nom }}</span>
                </div>
                <div class="detail-row">
                    <label>Adresse :</label>
                    <span>{{ selectedEstablishment.adresse }}</span>
                </div>
                <div class="detail-row">
                    <label>Code Postal :</label>
                    <span>{{ selectedEstablishment.codePostal }}</span>
                </div>
                <div class="detail-row">
                    <label>Ville :</label>
                    <span>{{ selectedEstablishment.ville }}</span>
                </div>
                <div class="detail-row">
                    <label>Pays :</label>
                    <span>{{ selectedEstablishment.pays }}</span>
                </div>
                <div class="detail-row">
                    <label>Téléphone :</label>
                    <span>{{ selectedEstablishment.telephone }}</span>
                </div>
                <div class="detail-row">
                    <label>Email :</label>
                    <span>{{ selectedEstablishment.email }}</span>
                </div>
                <div class="detail-row">
                    <label>Utilisateurs actuels :</label>
                    <span>{{ selectedEstablishment.nombreUtilisateursActuels }}</span>
                </div>
                <div class="detail-row">
                    <label>Utilisateurs maximum :</label>
                    <span>{{ selectedEstablishment.nombreMaxUtilisateurs }}</span>
                </div>
                <div class="detail-row">
                    <label>Créé le :</label>
                    <span>{{ selectedEstablishment.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                </div>
                <div class="detail-row">
                    <label>Mis à jour le :</label>
                    <span>{{ selectedEstablishment.updatedAt | date:'dd/MM/yyyy HH:mm' }}</span>
                </div>
            </div>
        </div>
    </div>
</app-layout>